# Copilot Build Environment Setup Steps
# This file contains steps to configure the Dragonfly build environment
# with AWS, GCP, GPERF, and UNWIND disabled for faster development builds

name: Dragonfly Development Build Setup

steps:
  - name: Install required system dependencies
    description: Install Boost context and other essential libraries
    commands:
      - sudo apt-get update
      - sudo apt-get install -y libboost-context-dev libunwind-dev

  - name: Initialize git submodules
    description: Clone helio and other required submodules
    commands:
      - git submodule update --init --recursive

  - name: Configure CMake build (Debug, no AWS/GCP)
    description: Configure debug build with AWS, GCP, GPERF, and UNWIND disabled
    commands:
      - ./helio/blaze.sh -DWITH_AWS=OFF -DWITH_GCP=OFF -DWITH_GPERF=OFF

  - name: Build specific test targets
    description: Build only the test targets you need
    examples:
      - cd build-dbg && ninja string_family_test
      - cd build-dbg && ninja generic_family_test
      - cd build-dbg && ninja <target_name>

  - name: Run tests
    description: Execute specific test suites
    examples:
      - cd build-dbg && ./string_family_test --gtest_filter="StringFamilyTest.SetGet"
      - cd build-dbg && ./generic_family_test --gtest_filter="GenericFamilyTest.Del"

  - name: Code formatting
    description: Run pre-commit hooks for code formatting
    commands:
      - pip3 install pre-commit
      - pre-commit run --files <modified_files>

notes:
  - The build directory will be created at build-dbg/
  - Disabling AWS/GCP significantly speeds up compilation
  - WITH_GPERF=OFF disables Google Performance Tools
  - libunwind-dev is required for stack traces
  - Use ninja for faster parallel builds
